<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dictionary App</title>
    <style>
    body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        margin: 0;
        padding: 20px;
        background-color: #f4f4f4;
    }
    .container {
        max-width: 800px;
        margin: auto;
        background: white;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 {
        text-align: center;
        color: #333;
    }
    form {
        display: flex;
        flex-direction: column;
        margin-bottom: 20px;
    }
    input, textarea {
        margin-bottom: 10px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    button {
        padding: 10px;
        background-color: #5cb85c;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    button:hover {
        background-color: #4cae4c;
    }
    #result {
        margin-top: 20px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        background-color: #fff;
    }
</style>
</head>
<body>
    <div class="container">
        <h1>Dictionary App</h1>
        
        <h2>Search for a Word</h2>
        <form id="searchForm">
            <input type="text" id="searchWord" placeholder="Enter a word" required>
            <button type="submit">Search</button>
        </form>

        <h2>Add a New Word</h2>
        <form id="addForm">
            <input type="text" id="newWord" placeholder="Word" required>
            <textarea id="definition" placeholder="Definition" required></textarea>
            <textarea id="example" placeholder="Example" required></textarea>
            <button type="submit">Add Word</button>
        </form>

        <div id="result"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const baseURL = 'https://blockdictionary.onrender.com';

            async function fetchWithTimeout(resource, options = {}) {
                const { timeout = 8000 } = options;
                
                const controller = new AbortController();
                const id = setTimeout(() => controller.abort(), timeout);

                const response = await fetch(resource, {
                    ...options,
                    signal: controller.signal  
                });
                clearTimeout(id);

                return response;
            }

            async function searchWord(word) {
                try {
                    console.log(`Searching for word: ${word}`);
                    const response = await fetchWithTimeout(`${baseURL}/${word}`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    });

                    console.log('Response status:', response.status);

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    console.log('Received data:', data);
                    return data;
                } catch (error) {
                    console.error('Error searching for word:', error);
                    if (error.name === 'AbortError') {
                        throw new Error('Request timed out. The server might be down or unreachable.');
                    }
                    throw error;
                }
            }

            async function addWord(wordData) {
                try {
                    console.log('Adding word:', wordData);
                    const response = await fetchWithTimeout(baseURL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(wordData),
                    });

                    console.log('Response status:', response.status);

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    console.log('Received result:', result);
                    return result;
                } catch (error) {
                    console.error('Error adding word:', error);
                    if (error.name === 'AbortError') {
                        throw new Error('Request timed out. The server might be down or unreachable.');
                    }
                    throw error;
                }
            }

            const searchForm = document.getElementById('searchForm');
            const addForm = document.getElementById('addForm');
            const resultDiv = document.getElementById('result');

            if (searchForm) {
                searchForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const word = document.getElementById('searchWord').value;
                    
                    try {
                        const data = await searchWord(word);
                        resultDiv.innerHTML = `
                            <h3>${data.word}</h3>
                            <p><strong>Definition:</strong> ${data.definition || 'Not available'}</p>
                            <p><strong>Example:</strong> ${data.Example || 'Not available'}</p>
                        `;
                    } catch (error) {
                        console.error('Error in search form submission:', error);
                        resultDiv.innerHTML = `<p>Error: ${error.message}</p>`;
                    }
                });
            } else {
                console.error('Search form not found');
            }

            if (addForm) {
                addForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const wordData = {
                        word: document.getElementById('newWord').value,
                        definition: document.getElementById('definition').value,
                        Example: document.getElementById('example').value,
                    };
                    
                    try {
                        const result = await addWord(wordData);
                        resultDiv.innerHTML = `<p>Word added successfully: ${result.word}</p>`;
                    } catch (error) {
                        console.error('Error in add form submission:', error);
                        resultDiv.innerHTML = `<p>Error: ${error.message}</p>`;
                    }
                });
            } else {
                console.error('Add form not found');
            }

            // Test API connection
            fetchWithTimeout(baseURL)
                .then(response => console.log('API connection test:', response.status))
                .catch(error => {
                    console.error('Error connecting to API:', error);
                    if (error.name === 'AbortError') {
                        console.error('The request timed out. The server might be down or unreachable.');
                    }
                });
        });
    </script>
</body>
</html>